# Лабораторная работа №1

## Тема: Управление продажами автомобилей

### Описание
Разработана **ER-диаграмма** базы данных для управления продажами автомобилей. Система позволяет хранить данные о клиентах, продажах, сотрудниках, автомобилях и их характеристиках. Все таблицы спроектированы так, чтобы удовлетворять **третьей нормальной форме (3NF)**.

### ER-диаграмма
![ER-диаграмма](https://github.com/user-attachments/assets/b3345a41-4dcc-4ce8-bf0f-9e6a98fa988a)

### Таблицы и их описание

1. **Customer** — данные о клиентах:
   - `id`: уникальный идентификатор клиента.
   - `first_name`, `last_name`, `surname`: полное имя клиента.
   - `adress`, `city`: адрес проживания.
   - `age`, `sex`: возраст и пол.

2. **Sale** — данные о продажах:
   - `id`: уникальный идентификатор сделки.
   - `date`: дата продажи.
   - `id_car`: автомобиль, который был продан.
   - `id_customer`: клиент, совершивший покупку.
   - `id_employee`: сотрудник, оформивший сделку.

3. **Car** — информация об автомобилях:
   - `id`: уникальный идентификатор автомобиля.
   - `model_id`: модель автомобиля.
   - `year`: год выпуска.
   - `color`: цвет автомобиля.
   - `price`: стоимость.

4. **Employee** — данные о сотрудниках:
   - `id`: уникальный идентификатор сотрудника.
   - `first_name`, `last_name`, `surname`: имя сотрудника.
   - `internship`: стаж работы.
   - `salary`: зарплата.

5. **Brand**, **Model**, **Category** — вспомогательные таблицы:
   - `Brand`: информация о брендах автомобилей.
   - `Model`: данные о моделях автомобилей.
   - `Category`: категории автомобилей.

---

### Нормализация данных
В проекте все таблицы приведены к **третьей нормальной форме (3NF)**:
- **Первая нормальная форма (1NF):** все данные разложены по отдельным колонкам, значения атомарны.
- **Вторая нормальная форма (2NF):** данные не содержат частичных зависимостей.
- **Третья нормальная форма (3NF):** данные не содержат транзитивных зависимостей.

---

# Лабораторная работа №2

## Тема: Создание схемы базы данных и выполнение запросов
![{00FD54F7-CEB0-404B-813E-9587CD3E59B5}](https://github.com/user-attachments/assets/cfd4d79f-fc5a-4660-91b6-8d491d0ddaf3)
### Описание
В рамках лабораторной работы была создана схема, содержащая таблицы из диаграммы:


Для каждой таблицы добавлено не менее 4 записей, а также заданы ограничения:
- **Первичный ключ (`PRIMARY KEY`)** для идентификаторов.
- **Внешние ключи (`FOREIGN KEY`)** для связей между таблицами.
- Ограничения на типы данных (`INTEGER`, `TEXT`, `DATE` и т. д.).

![{D5CC0575-8D44-46BF-8188-BD445A70ABA0}](https://github.com/user-attachments/assets/335d3cf7-293a-4d95-85cb-67e65ffc2dac)


### SQL-запрос
Написан запрос, объединяющий данные из таблиц **Customer**, **Car** и **Sale**, чтобы вывести информацию о клиентах, автомобилях и дате их покупки.

![{51E44E46-2350-478E-8EC7-2A76E97E4AE1}](https://github.com/user-attachments/assets/139b56f2-aa0a-4117-9557-e3885e3e6e3b)
![{133F204A-1EAF-4638-AF91-411C5C8E409B}](https://github.com/user-attachments/assets/ef8a753d-afb4-4336-9bce-8da6caad1295)

# Лабораторная работа №3
## Тема: Создание представления и выборка записей по условию времени
### Описание
В рамках лабораторной работы создано представление для таблиц проекта. Также написан запрос, который возвращает записи только на **чётной секунде** и исключает записи на **нечётной секунде**.
### Создание представления
Для упрощения запросов было создано представление **`price_buyer`**, которое объединяет данные о:
- Полном имени клиента.
- Цене автомобиля.
- Дате продажи.
- Названии бренда автомобиля.

![image](https://github.com/user-attachments/assets/63e2b0a0-883d-407c-91cd-b16fc463dc66)
![image](https://github.com/user-attachments/assets/63a3751c-feb5-4eff-ace4-462193dab756)

###Условие выбора записей
Для выборки данных только на **чётной секунде** используется запрос с условием **`EXTRACT(SECOND)`**.
Код запроса:
![image](https://github.com/user-attachments/assets/fb5ab817-77e1-45f5-90a6-a2ae8cf4cf24)

Запрос с нечётной секундой **`(2024-01-01 3:00:01)`** не возвращает данных, так как записи доступны **только на чётной секунде**.

![image](https://github.com/user-attachments/assets/538bd6c2-4c0c-4119-b4c9-d94efebdd5d5)
# Лабораторная работа №4
## Тема: Анализ плана выполнения SQL-запроса
## Описание
В рамках лабораторной работы выполнен запрос, объединяющий данные из двух таблиц. Проведён анализ плана его выполнения с использованием команды `EXPLAIN ANALYZE`. Также показано влияние индекса на производительность запроса.

### Запрос без индекса
Написан SQL-запрос для соединения таблиц **`Customer`** и **`Sale`**, чтобы получить данные о покупателях, дате покупки и идентификаторе автомобиля.
Команда `EXPLAIN ANALYZE` позволяет увидеть, как PostgreSQL обрабатывает запрос.
![image](https://github.com/user-attachments/assets/14f76335-1317-4d9b-b5b4-45e85263777d)


### Запрос с индексом
Для оптимизации запроса создан индекс на колонке `id_customer` таблицы **`Sale`**.
![image](https://github.com/user-attachments/assets/17cfbcb3-c755-45b3-b6cc-e1bd2f43fbcc)

После создания индекса запрос выполнен повторно.
![image](https://github.com/user-attachments/assets/f3714b00-a68f-428a-8528-d0c28b996409)

### Вывод
- **Без индекса:** Запрос выполняется медленнее из-за полного сканирования таблицы `Sale`.
- **С индексом:** Время выполнения запроса сократилось примерно на 15%, что демонстрирует эффективность индексов для оптимизации запросов.
- Индексы полезны для полей, которые часто участвуют в `JOIN` или фильтрах (`WHERE`).

# Лабораторная работа №5

## Тема: Создание таблицы логов и триггеров

### Описание
В рамках лабораторной работы была создана таблица логов для отслеживания операций `INSERT`, `UPDATE`, `DELETE`, выполняемых на таблице **Customer**. Также разработаны триггеры для автоматического добавления записей в таблицу логов при выполнении указанных операций.

---

### Шаг 1: Создание таблицы логов
Для хранения данных о выполненных операциях создана таблица **log**, которая фиксирует:
- Название таблицы, где произошла операция.
- Тип операции (`INSERT`, `UPDATE`, `DELETE`).
- Время выполнения операции.

![image](https://github.com/user-attachments/assets/03a6ccd8-2ee8-479e-8fa2-60410ab4dcea)


---

### Шаг 2: Создание функции для триггеров
Разработана функция `log_customer_changes()`, которая добавляет записи в таблицу **log** при выполнении операций на таблице **Customer**.

![image](https://github.com/user-attachments/assets/411e9cb7-a4dd-4b6c-806b-89b8d3dde740)

---

### Шаг 3: Создание триггеров
Созданы три триггера для отслеживания операций:
1. **INSERT**: добавляет запись в лог при добавлении новых клиентов.
2. **UPDATE**: фиксирует изменения данных клиента.
3. **DELETE**: записывает информацию об удалении клиента.


![image](https://github.com/user-attachments/assets/115f2372-0223-42d7-aa7b-bbb27d1482b5)

---

### Шаг 4: Проверка триггеров

#### Тест 1: Добавление данных (`INSERT`)
В таблицу **Customer** добавлена новая запись. Результат записан в таблицу **log**.

![image](https://github.com/user-attachments/assets/bb24afcb-463c-4490-89c8-dae44a0f8bbb)

---

#### Тест 2: Изменение данных (`UPDATE`)
Выполнено обновление данных в таблице **Customer**. Операция успешно зафиксирована в логах.



![image](https://github.com/user-attachments/assets/2245ce40-6ac0-4ddb-96c4-b3e8979d6ed0)

---

#### Тест 3: Удаление данных (`DELETE`)
Удалена запись из таблицы **Customer**. Операция также записана в таблицу логов.


![image](https://github.com/user-attachments/assets/9a29d37c-f2d8-442b-863f-1a1756105d4a)

![image](https://github.com/user-attachments/assets/84ea3dcf-be09-4a36-8e50-de76707f46d7)
---

### Шаг 5: Проверка итогового состояния таблицы логов
Все операции (`INSERT`, `UPDATE`, `DELETE`) успешно зафиксированы. Таблица логов содержит соответствующие записи.


![image](https://github.com/user-attachments/assets/94aa6cdf-4f6c-4f3d-897e-3155c67e310f)

---

### Итог:
1. Создана таблица логов для отслеживания операций над таблицей **Customer**.
2. Реализованы триггеры для автоматической записи операций в лог.
3. Успешно протестировано выполнение операций `INSERT`, `UPDATE`, `DELETE`.











